<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Reset Password | AR Network House</title>

<style>
body{
  font-family:Segoe UI,Arial;
  background:#f1f5f9;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  width:100%;
  max-width:420px;
  background:#fff;
  padding:30px;
  border-radius:10px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
}
.login-logo {
      margin-bottom: 20px;
        display: flex;
  justify-content: center;
    }

    .login-logo img {
      max-width: 140px;
      height: auto;
      align-items: center;
    }
h2{text-align:center;margin-bottom:10px}
p{text-align:center;color:#64748b;margin-bottom:20px}
input{
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border:1px solid #cbd5f5;
  border-radius:6px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  background:#2563eb;
  color:#fff;
  border-radius:6px;
  font-weight:600;
  cursor:pointer;
}
button:hover{background:#1d4ed8}
.msg{text-align:center;margin-top:12px;font-size:14px}
.error{color:#ef4444}
.success{color:#22c55e}
.hide{display:none}
</style>
</head>

<body>

<div class="card">
    <div class="login-logo">
      <img src="https://github.com/arnetworkhouse-oss/ar-network-house/blob/main/ar%20logo.jpg?raw=true" alt="AR Network House">
    </div>

  <h2 id="title">Account Recovery</h2>
  <p id="subtitle">Enter your Employee ID</p>

  <!-- STEP 1 -->
  <div id="step1">
    <input id="empId" placeholder="Employee ID" />
    <button onclick="sendOTP()">Send OTP</button>
    <p style="margin-top: 16px; font-size: 13px;">
      <a href="https://arnetworkhouse-oss.github.io/ar-network-house/login.html" style="color: #2563eb; text-decoration: none;">Back to Login</a>
  </div>

  <!-- STEP 2 -->
  <div id="step2" class="hide">
    <input id="otp" placeholder="6 digit OTP" />
    <button onclick="verifyOTP()">Verify OTP</button>
  </div>

  <!-- STEP 3 -->
  <div id="step3" class="hide">
    <input id="pass" type="password" placeholder="New Password" />
    <input id="confirm" type="password" placeholder="Confirm Password" />
    <button onclick="resetPassword()">Reset Password</button>
  </div>

  <div id="msg" class="msg"></div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxa53ytoeXIwotR_1YMwERA8cv5U96qoDS8DNbceciNpM3CWaCbKd10yKMi8PwyUSkt/exec";

function show(id){
  ["step1","step2","step3"].forEach(s=>document.getElementById(s).classList.add("hide"));
  document.getElementById(id).classList.remove("hide");
}

function message(text,type=""){
  const m=document.getElementById("msg");
  m.innerText=text;
  m.className="msg "+type;
}

/* ðŸ”‘ FORM POST â€“ NO JSON â€“ NO HEADERS */
async function post(data){
  const fd=new URLSearchParams();
  for(const k in data){fd.append(k,data[k]);}
  const r=await fetch(API_URL,{method:"POST",body:fd});
  return r.json();
}

async function sendOTP(){
  const empId=document.getElementById("empId").value.trim();
  if(!empId)return message("Employee ID required","error");

  try{
    const r=await post({action:"SEND_OTP",employeeId:empId});
    if(!r.success)throw r.message;
    show("step2");
    message("OTP sent to email","success");
    document.getElementById("title").innerText="Verify OTP";
    document.getElementById("subtitle").innerText="Check your email";
  }catch(e){message(e,"error")}
}

async function verifyOTP(){
  const empId=document.getElementById("empId").value.trim();
  const otp=document.getElementById("otp").value.trim();
  if(!otp)return message("OTP required","error");

  try{
    const r=await post({action:"VERIFY_OTP",employeeId:empId,otp});
    if(!r.success)throw r.message;
    show("step3");
    message("");
    document.getElementById("title").innerText="Set New Password";
    document.getElementById("subtitle").innerText="Minimum 8 characters";
  }catch(e){message(e,"error")}
}

async function resetPassword(){
  const empId=document.getElementById("empId").value.trim();
  const p=document.getElementById("pass").value;
  const c=document.getElementById("confirm").value;
  if(p.length<8)return message("Password too short","error");
  if(p!==c)return message("Password mismatch","error");

  try{
    const r=await post({action:"RESET_PASSWORD",employeeId:empId,newPassword:p});
    if(!r.success)throw r.message;
    message("Password updated successfully","success");
    setTimeout(()=>location.href="login.html",2000);
  }catch(e){message(e,"error")}
}
</script>

</body>
</html>
